#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         ğŸ”„ ××™×¤×•×¡ ××œ× ×©×œ ×”××¢×¨×›×ª - Full Reset              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âš ï¸  ×¤×¢×•×œ×” ×–×• ×ª×‘×¦×¢:"
echo "   1. ğŸ—‘ï¸  ××—×™×§×ª ×›×œ ×”× ×ª×•× ×™× ××”×“××˜××‘×™×™×¡ (×˜×¨× ×–×§×¦×™×•×ª, ×ª×§×¦×™×‘×™×, ×™×¢×“×™×)"
echo "   2. ğŸ—‘ï¸  ××—×™×§×ª WhatsApp session (×ª×¦×˜×¨×š ×œ×¡×¨×•×§ QR ××—×“×©)"
echo "   3. ğŸ›‘  ×¢×¦×™×¨×ª ×ª×”×œ×™×›×™ ×”×‘×•×˜ ×”×¨×¦×™×"
echo ""
echo "â›” ×¤×¢×•×œ×” ×–×• ×‘×œ×ª×™ ×”×¤×™×›×”! ×›×œ ×”× ×ª×•× ×™× ×™××—×§×• ×œ×¦××™×ª×•×ª."
echo ""

read -p "â“ ×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”××©×™×š? (×›×ª×•×‘ '×›×Ÿ' ××• 'yes'): " confirm

if [[ "$confirm" != "×›×Ÿ" && "$confirm" != "yes" ]]; then
    echo ""
    echo "âŒ ×”××™×¤×•×¡ ×‘×•×˜×œ ×¢×œ ×™×“×™ ×”××©×ª××©"
    exit 0
fi

echo ""
echo "ğŸš€ ××ª×—×™×œ ××™×¤×•×¡ ××œ×..."
echo ""

# Step 1: Stop running processes
echo "ğŸ›‘ ×¢×•×¦×¨ ×ª×”×œ×™×›×™× ×™×©× ×™×..."
pkill -9 -f "node server.js" 2>/dev/null
sleep 1
echo "   âœ… ×ª×”×œ×™×›×™× × ×¢×¦×¨×•"

# Step 2: Delete WhatsApp session
echo ""
echo "ğŸ—‘ï¸  ××•×—×§ WhatsApp session..."
rm -rf .wwebjs_auth .wwebjs_cache
echo "   âœ… Session × ××—×§"

# Step 3: Reset database
echo ""
echo "ğŸ—‘ï¸  ×××¤×¡ ××ª ××¡×“ ×”× ×ª×•× ×™×..."
node reset-database.js <<EOF
×›×Ÿ
EOF

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘            âœ… ×”××™×¤×•×¡ ×”×•×©×œ× ×‘×”×¦×œ×—×”!                       â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“‹ ××” ×”×œ××”?"
echo "   1. ×”×¤×¢×œ ××ª ×”×‘×•×˜: npm start"
echo "   2. ×¡×¨×•×§ ××ª QR code ×¢× WhatsApp"
echo "   3. ×”×ª×—×œ ×œ×”×©×ª××© ××—×“×©!"
echo ""
